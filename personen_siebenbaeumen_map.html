<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />

    <style>
        html, body { height: 100%; margin: 0; }
        .leaflet-container { font-size: 1rem; }
        .map-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; }

        /* Legend */
        .personen-legende {
            position: fixed;
            bottom: 18px;
            left: 18px;
            width: 240px;
            max-height: 45vh;
            overflow: auto;
            background: rgba(255,255,255,0.95);
            border: 1px solid #888;
            padding: 8px;
            z-index: 9999;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            font-size: 14px;
            border-radius: 4px;
        }
        .personen-legende h4 { margin: 0 0 8px 0; font-size: 16px; }
        .personen-legende .legend-item { margin-bottom: 6px; display:flex; align-items:center; }
        .personen-legende .swatch { width:14px; height:14px; margin-right:8px; border-radius:2px; }

        /* Mobile: collapsible legend */
        @media (max-width: 600px) {
            .personen-legende { left: 10px; right: 10px; width: auto; max-height: 35vh; }
            .legend-toggle { display:block; margin-bottom:8px; }
        }
        .legend-toggle { display:none; cursor:pointer; color:#007bff; background:none; border:none; padding:0; }
    </style>

    <!-- JS libs (jQuery then Bootstrap then Leaflet) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

    <script>
        // Folium compatibility globals
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
</head>
<body>

<div class="personen-legende" id="personen-legende">
    <button class="legend-toggle" id="legendToggle">☰ Legende anzeigen</button>
    <h4>Personen-Legende</h4>
    <div id="legendItems"></div>
</div>

<div class="map-container">
    <div id="map_21252aa77d575d91a03b2668df530c05" class="folium-map" style="width:100%; height:100%;"></div>
</div>

<script>
(function(){
    // Data for people (name, color, birth/death place names, coords, popup HTML)
    var people = [
        { name: "Albert Bohnsack", color: "red", birth: "Siebenbäumen", death: "Breslau", coordsBirth: [53.7503512, 10.5292609], coordsDeath: [51.1089776, 17.0326689] },
        { name: "Ewald Glubs", color: "blue", birth: "Steinhorst", death: "Sewastopol", coordsBirth: [53.7206815, 10.4834423], coordsDeath: [44.6054434, 33.5220842] },
        { name: "Herbert Dabelstein", color: "green", birth: "Siebenbäumen", death: "Brest", coordsBirth: [53.7503512, 10.5292609], coordsDeath: [47.3470611, -3.1548668] }
    ];

    // Initialize map
    var map = L.map('map_21252aa77d575d91a03b2668df530c05', { center:[51.0,10.0], zoom:5, zoomControl:true });
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19, attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    // Build markers and legend from data
    var bounds = [];
    people.forEach(function(p){
        // marker at birth
        var iconBirth = L.AwesomeMarkers.icon({ markerColor: p.color, icon: 'user', prefix: 'fa', iconColor: 'white' });
        var mBirth = L.marker(p.coordsBirth, { icon: iconBirth }).addTo(map);
        var popupBirthHtml = '<div><b>' + p.name + '</b><br>Geburtsort: ' + (p.birth || '(nicht angegeben)') + '</div>';
        mBirth.bindPopup(popupBirthHtml);
        bounds.push(p.coordsBirth);

        // marker at death
        var iconDeath = L.AwesomeMarkers.icon({ markerColor: p.color, icon: 'times', prefix: 'fa', iconColor: 'white' });
        var mDeath = L.marker(p.coordsDeath, { icon: iconDeath }).addTo(map);
        var popupDeathHtml = '<div><b>' + p.name + '</b><br>Todesort: ' + (p.death || '(nicht angegeben)') + '</div>';
        mDeath.bindPopup(popupDeathHtml);
        bounds.push(p.coordsDeath);

        // polyline between birth and death
        var poly = L.polyline([p.coordsBirth, p.coordsDeath], { color: p.color, weight: 2 }).addTo(map);
        poly.bindTooltip('<div>' + p.name + '<br><small>Geburt: ' + (p.birth || '(?)') + '<br>Tod: ' + (p.death || '(?)') + '</small></div>', { sticky: true });

        // add to legend
        var legendItems = document.getElementById('legendItems');
        var item = document.createElement('div'); item.className = 'legend-item';
        var sw = document.createElement('span'); sw.className = 'swatch'; sw.style.background = p.color;
        var label = document.createElement('span'); label.innerHTML = p.name;
        item.appendChild(sw); item.appendChild(label);
        legendItems.appendChild(item);
    });

    if(bounds.length) map.fitBounds(bounds);

    // Legend toggle for small screens
    var toggle = document.getElementById('legendToggle');
    var legend = document.getElementById('personen-legende');
    toggle.addEventListener('click', function(){
        var items = document.getElementById('legendItems');
        if(items.style.display === 'none' || items.style.display === ''){
            items.style.display = 'block';
            toggle.textContent = '− Legende verbergen';
        } else {
            items.style.display = 'none';
            toggle.textContent = '☰ Legende anzeigen';
        }
    });
    // Hide legend items on very small screens by default
    if(window.innerWidth <= 600){ document.getElementById('legendItems').style.display = 'none'; toggle.style.display = 'block'; }
})();
</script>

</body>
</html>